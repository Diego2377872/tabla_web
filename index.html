<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Actividades</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Registro de Actividades</h1>

    <!-- Formulario -->
    <form id="activity-form" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <input type="date" id="fecha" required class="border p-2 rounded" placeholder="Fecha" />
      <input type="text" id="actividad" placeholder="Actividad" class="border p-2 rounded" />
      <input type="text" id="institucion" placeholder="Institución" class="border p-2 rounded" />
      <input type="number" id="cuadernillo" placeholder="Nº de Cuadernillo" class="border p-2 rounded" />
      <button type="submit" class="col-span-2 md:col-span-4 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Agregar</button>
    </form>

    <!-- Tabla -->
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-300 rounded shadow">
        <thead class="bg-blue-100">
          <tr>
            <th class="border px-4 py-2">Fecha</th>
            <th class="border px-4 py-2">Actividad</th>
            <th class="border px-4 py-2">Institución</th>
            <th class="border px-4 py-2">Nº de Cuadernillo</th>
          </tr>
        </thead>
        <tbody id="tabla-actividades">
          <!-- Datos se llenan dinámicamente -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const form = document.getElementById("activity-form");
    const tabla = document.getElementById("tabla-actividades");

    async function cargarDatos() {
      try {
        const response = await fetch("/.netlify/functions/obtener");
        const data = await response.json();
        renderizarTabla(data);
      } catch (error) {
        console.error("Error al cargar datos:", error);
      }
    }

    function renderizarTabla(datos) {
      tabla.innerHTML = "";
      datos.forEach(item => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td class="border px-4 py-2">${item.fecha}</td>
          <td class="border px-4 py-2">${item.actividad}</td>
          <td class="border px-4 py-2">${item.institucion}</td>
          <td class="border px-4 py-2">${item.cuadernillo || ""}</td>
        `;
        tabla.appendChild(fila);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nuevoRegistro = {
        fecha: document.getElementById("fecha").value,
        actividad: document.getElementById("actividad").value,
        institucion: document.getElementById("institucion").value,
        cuadernillo: document.getElementById("cuadernillo").value
      };

      try {
        const response = await fetch("/.netlify/functions/guardar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(nuevoRegistro),
        });

        if (!response.ok) throw new Error("Error al guardar");

        form.reset();
        cargarDatos(); // Actualizar la tabla
      } catch (error) {
        console.error("Error al guardar:", error);
      }
    });

    // Cargar datos al iniciar
    cargarDatos();
  </script>

</body>
</html>
